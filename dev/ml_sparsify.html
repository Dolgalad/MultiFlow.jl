<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Machine Learning · MultiFlows.jl</title><meta name="title" content="Machine Learning · MultiFlows.jl"/><meta property="og:title" content="Machine Learning · MultiFlows.jl"/><meta property="twitter:title" content="Machine Learning · MultiFlows.jl"/><meta name="description" content="Documentation for MultiFlows.jl."/><meta property="og:description" content="Documentation for MultiFlows.jl."/><meta property="twitter:description" content="Documentation for MultiFlows.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script><link href="assets/extra_styles.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">MultiFlows.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><span class="tocitem">First steps</span><ul><li><a class="tocitem" href="index.html">MultiFlows.jl</a></li></ul></li><li><span class="tocitem">Core API</span><ul><li><a class="tocitem" href="core_functions/feature_graph.html">Feature Graph</a></li><li><a class="tocitem" href="core_functions/path.html">Paths</a></li></ul></li><li><span class="tocitem">Multi-Commodity Flows</span><ul><li><a class="tocitem" href="mcf/mcf.html">Multi-Commodity Flow</a></li><li><a class="tocitem" href="mcf/io.html">Reading/writing MCFs</a></li><li><a class="tocitem" href="mcf/plot.html">Plotting</a></li></ul></li><li><span class="tocitem">Solvers</span><ul><li><a class="tocitem" href="solvers/solver_statistics.html">Solver Statistics</a></li><li><a class="tocitem" href="solvers/heuristic_solver.html">Heuristics</a></li><li><a class="tocitem" href="solvers/compact_solver.html">Solving Compact Formulation</a></li><li><a class="tocitem" href="solvers/column_generation.html">Column Generation</a></li></ul></li><li><span class="tocitem">Datasets</span><ul><li><a class="tocitem" href="datasets/description.html">Datasets</a></li><li><a class="tocitem" href="datasets/generators.html">Instance generation</a></li></ul></li><li><span class="tocitem">Sparsification</span><ul><li><a class="tocitem" href="sparsify.html">MCF Sparsification</a></li><li class="is-active"><a class="tocitem" href="ml_sparsify.html">Machine Learning</a><ul class="internal"><li><a class="tocitem" href="#Index"><span>Index</span></a></li><li><a class="tocitem" href="#Instance-encoding"><span>Instance encoding</span></a></li><li><a class="tocitem" href="#Datasets"><span>Datasets</span></a></li><li><a class="tocitem" href="#Layers-and-utilities"><span>Layers and utilities</span></a></li><li><a class="tocitem" href="#Classifier-model"><span>Classifier model</span></a></li></ul></li></ul></li><li><span class="tocitem">Installation and development</span><ul><li><a class="tocitem" href="development.html">Installation and Development</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Sparsification</a></li><li class="is-active"><a href="ml_sparsify.html">Machine Learning</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="ml_sparsify.html">Machine Learning</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Dolgalad/MultiFlows.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/Dolgalad/MultiFlows.jl/blob/main/docs/src/ml_sparsify.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Machine-Learning"><a class="docs-heading-anchor" href="#Machine-Learning">Machine Learning</a><a id="Machine-Learning-1"></a><a class="docs-heading-anchor-permalink" href="#Machine-Learning" title="Permalink"></a></h1><p>Machine learning based sparsification.</p><h2 id="Index"><a class="docs-heading-anchor" href="#Index">Index</a><a id="Index-1"></a><a class="docs-heading-anchor-permalink" href="#Index" title="Permalink"></a></h2><ul><li><a href="ml_sparsify.html#MultiFlows.ML.AugmentedGraph"><code>MultiFlows.ML.AugmentedGraph</code></a></li><li><a href="ml_sparsify.html#MultiFlows.ML.M3EdgeReverseLayer"><code>MultiFlows.ML.M3EdgeReverseLayer</code></a></li><li><a href="ml_sparsify.html#MultiFlows.ML.M3EdgeReverseLayer-Tuple{GraphNeuralNetworks.GNNGraphs.GNNGraph}"><code>MultiFlows.ML.M3EdgeReverseLayer</code></a></li><li><a href="ml_sparsify.html#MultiFlows.ML.M8ClassifierModel-Tuple{MCF}"><code>MultiFlows.ML.M8ClassifierModel</code></a></li><li><a href="ml_sparsify.html#MultiFlows.ML.M8ClassifierModel-Tuple{GraphNeuralNetworks.GNNGraphs.GNNGraph}"><code>MultiFlows.ML.M8ClassifierModel</code></a></li><li><a href="ml_sparsify.html#MultiFlows.ML.M8ClassifierModel-NTuple{4, Int64}"><code>MultiFlows.ML.M8ClassifierModel</code></a></li><li><a href="ml_sparsify.html#MultiFlows.ML.M8ClassifierModel"><code>MultiFlows.ML.M8ClassifierModel</code></a></li><li><a href="ml_sparsify.html#MultiFlows.ML.M8MPLayer-Tuple{Int64}"><code>MultiFlows.ML.M8MPLayer</code></a></li><li><a href="ml_sparsify.html#MultiFlows.ML.M8MPLayer"><code>MultiFlows.ML.M8MPLayer</code></a></li><li><a href="ml_sparsify.html#MultiFlows.ML.M8MPLayer-Tuple{Any, Any, Any}"><code>MultiFlows.ML.M8MPLayer</code></a></li><li><a href="ml_sparsify.html#MultiFlows.ML.MLP-Tuple{Any, Any, Any}"><code>MultiFlows.ML.MLP</code></a></li><li><a href="ml_sparsify.html#MultiFlows.ML.MyMEGNetConv3-Tuple{Int64}"><code>MultiFlows.ML.MyMEGNetConv3</code></a></li><li><a href="ml_sparsify.html#MultiFlows.ML.aggregate_demand_labels-Tuple{GraphNeuralNetworks.GNNGraphs.GNNGraph}"><code>MultiFlows.ML.aggregate_demand_labels</code></a></li><li><a href="ml_sparsify.html#MultiFlows.ML.augmented_graph-Tuple{MCF}"><code>MultiFlows.ML.augmented_graph</code></a></li><li><a href="ml_sparsify.html#MultiFlows.ML.compute_edge_demand_scores-Tuple{Any, AbstractMatrix, AbstractMatrix, GraphNeuralNetworks.GNNGraphs.GNNGraph}"><code>MultiFlows.ML.compute_edge_demand_scores</code></a></li><li><a href="ml_sparsify.html#MultiFlows.ML.compute_graph_embeddings-Tuple{MultiFlows.ML.M8ClassifierModel, GraphNeuralNetworks.GNNGraphs.GNNGraph}"><code>MultiFlows.ML.compute_graph_embeddings</code></a></li><li><a href="ml_sparsify.html#MultiFlows.ML.concat_nodes-Tuple{AbstractMatrix, AbstractMatrix, Nothing}"><code>MultiFlows.ML.concat_nodes</code></a></li><li><a href="ml_sparsify.html#MultiFlows.ML.get_instance-Tuple{MultiFlows.ML.AugmentedGraph}"><code>MultiFlows.ML.get_instance</code></a></li><li><a href="ml_sparsify.html#MultiFlows.ML.load_dataset-Tuple{String}"><code>MultiFlows.ML.load_dataset</code></a></li><li><a href="ml_sparsify.html#MultiFlows.ML.load_instance-Tuple{Any}"><code>MultiFlows.ML.load_instance</code></a></li><li><a href="ml_sparsify.html#MultiFlows.ML.make_batchable-Tuple{Vector{GraphNeuralNetworks.GNNGraphs.GNNGraph}}"><code>MultiFlows.ML.make_batchable</code></a></li><li><a href="ml_sparsify.html#MultiFlows.ML.make_demand_codes-Tuple{AbstractMatrix, AbstractMatrix, GraphNeuralNetworks.GNNGraphs.GNNGraph}"><code>MultiFlows.ML.make_demand_codes</code></a></li><li><a href="ml_sparsify.html#MultiFlows.ML.make_demand_codes-Tuple{MultiFlows.ML.M8ClassifierModel, GraphNeuralNetworks.GNNGraphs.GNNGraph}"><code>MultiFlows.ML.make_demand_codes</code></a></li><li><a href="ml_sparsify.html#MultiFlows.ML.make_demand_codes-Tuple{AbstractMatrix, GraphNeuralNetworks.GNNGraphs.GNNGraph}"><code>MultiFlows.ML.make_demand_codes</code></a></li><li><a href="ml_sparsify.html#MultiFlows.ML.ones_and_zeros"><code>MultiFlows.ML.ones_and_zeros</code></a></li><li><a href="ml_sparsify.html#MultiFlows.ML.to_gnngraph-Tuple{MCF}"><code>MultiFlows.ML.to_gnngraph</code></a></li><li><a href="ml_sparsify.html#MultiFlows.ML.to_gnngraph-Tuple{MCF, AbstractMatrix{Bool}}"><code>MultiFlows.ML.to_gnngraph</code></a></li><li><a href="ml_sparsify.html#MultiFlows.demand_amounts-Tuple{GraphNeuralNetworks.GNNGraphs.GNNGraph}"><code>MultiFlows.demand_amounts</code></a></li><li><a href="ml_sparsify.html#MultiFlows.demand_endpoints-Tuple{GraphNeuralNetworks.GNNGraphs.GNNGraph}"><code>MultiFlows.demand_endpoints</code></a></li></ul><h2 id="Instance-encoding"><a class="docs-heading-anchor" href="#Instance-encoding">Instance encoding</a><a id="Instance-encoding-1"></a><a class="docs-heading-anchor-permalink" href="#Instance-encoding" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.AugmentedGraph" href="#MultiFlows.ML.AugmentedGraph"><code>MultiFlows.ML.AugmentedGraph</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">AugmentedGraph</code></pre><p>Representation of an MCF instance as a directed graph. Demands are represented as vertices of the graph connected to the source and destination vertices. <code>node_mask,edge_mask</code> are boolean valued vectors respectively indicating the positions of the original graph vertices and edges. <code>.!node_mask, .!edge_mask</code> are used to retrieve vertices and edges corresponding to the demands.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/augmented_graph.jl#L1-L5">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.aggregate_demand_labels-Tuple{GraphNeuralNetworks.GNNGraphs.GNNGraph}" href="#MultiFlows.ML.aggregate_demand_labels-Tuple{GraphNeuralNetworks.GNNGraphs.GNNGraph}"><code>MultiFlows.ML.aggregate_demand_labels</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">aggregate_demand_labels(g::GNNGraph)</code></pre><p>Combine the labels for demands that share endpoints. If demands <span>$k_1, k_2$</span> are such that <span>$s_{k_1}=s_{k_2}$</span> and <span>$t_{k_1} = t_{k_2}$</span> then their respective labels <span>$l_1, l_2$</span> are set to <span>$l_1 = l_2 = l_1 \&amp; l_2$</span>.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; pb = MCF(grid((2,2)), rand(4), rand(4), [Demand(1,4,1.), Demand(1,4,1.), Demand(3,2,1.)]);

julia&gt; y = rand(Bool, ne(pb), nk(pb))
8×3 Matrix{Bool}:
 1  0  0
 1  0  1
 1  1  0
 0  0  1
 1  1  1
 0  0  1
 1  1  1
 0  0  1

julia&gt; gnn = aggregate_demand_labels(to_gnngraph(pb, y));

julia&gt; gnn.targets
8×3×1 Array{Bool, 3}:
[:, :, 1] =
 1  1  0
 1  1  1
 1  1  0
 0  0  1
 1  1  1
 0  0  1
 1  1  1
 0  0  1
</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/augmented_graph.jl#L310-L346">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.augmented_graph-Tuple{MCF}" href="#MultiFlows.ML.augmented_graph-Tuple{MCF}"><code>MultiFlows.ML.augmented_graph</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">augmented_graph(pb::MCF)</code></pre><p>Converts a <a href="mcf/mcf.html#MultiFlows.MCF"><code>MCF</code></a> object to <a href="ml_sparsify.html#MultiFlows.ML.AugmentedGraph"><code>AugmentedGraph</code></a>.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; pb = MCF(grid((3,3)), rand(12), rand(12), [Demand(1,9,1.)]);

julia&gt; g = augmented_graph(pb);

julia&gt; pb.graph.srcnodes == g.edge_src[g.edge_mask]
true

julia&gt; pb.graph.dstnodes == g.edge_dst[g.edge_mask]
true

julia&gt; costs(pb) == g.edge_features[1,g.edge_mask]
true

julia&gt; capacities(pb) == g.edge_features[2,g.edge_mask]
true
</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/augmented_graph.jl#L26-L50">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.get_instance-Tuple{MultiFlows.ML.AugmentedGraph}" href="#MultiFlows.ML.get_instance-Tuple{MultiFlows.ML.AugmentedGraph}"><code>MultiFlows.ML.get_instance</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">get_instance(g::AugmentedGraph)</code></pre><p>Convert an <a href="ml_sparsify.html#MultiFlows.ML.AugmentedGraph"><code>AugmentedGraph</code></a> object to the corresponding <a href="mcf/mcf.html#MultiFlows.MCF"><code>MCF</code></a> object.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; pb = MCF(grid((3,3)), rand(12), rand(12), [Demand(1,9,1.)])
MCF(nv = 9, ne = 24, nk = 1)
	Demand{Int64, Float64}(1, 9, 1.0)

julia&gt; g = augmented_graph(pb);

julia&gt; pb1 = get_instance(g)
MCF(nv = 9, ne = 24, nk = 1)
	Demand{Int64, Float64}(1, 9, 1.0)

julia&gt; pb1 == pb
true</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/augmented_graph.jl#L87-L107">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.ones_and_zeros" href="#MultiFlows.ML.ones_and_zeros"><code>MultiFlows.ML.ones_and_zeros</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ones_and_zeros(k::Int64, 
               dev::Function=CUDA.functional() ? Flux.gpu : Flux.cpu
)</code></pre><p>Utility function that concatenated a vector of <code>k</code> ones with <code>k</code> zeros and sends the result to the GPU if available.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/augmented_graph.jl#L274-L280">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.to_gnngraph-Tuple{MCF, AbstractMatrix{Bool}}" href="#MultiFlows.ML.to_gnngraph-Tuple{MCF, AbstractMatrix{Bool}}"><code>MultiFlows.ML.to_gnngraph</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">to_gnngraph(pb::MCF, y::AbstractMatrix; feature_type::DataType=eltype(costs(pb)))</code></pre><p>Convert a UMFData instance to GNNGraph object with target labels.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; pb = MCF(grid((3,3)), rand(12), rand(12), [Demand(1,9,1.)]);

julia&gt; y = rand(Bool, ne(pb), nk(pb));

julia&gt; to_gnngraph(pb, y)
GNNGraph:
  num_nodes: 10
  num_edges: 26
  ndata:
	mask = 10-element Vector{Bool}
  edata:
	e = 3×26 Matrix{Float64}
	demand_amounts_mask = 26-element BitVector
	mask = 26-element Vector{Bool}
	demand_to_source_mask = 26-element Vector{Bool}
	target_to_demand_mask = 26-element Vector{Bool}
  gdata:
	targets = 24×1 Matrix{Bool}
	K = 1
	E = 24

</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/augmented_graph.jl#L196-L227">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.to_gnngraph-Tuple{MCF}" href="#MultiFlows.ML.to_gnngraph-Tuple{MCF}"><code>MultiFlows.ML.to_gnngraph</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">to_gnngraph(pb::MCF; feature_type::DataType=eltype(costs(pb)))</code></pre><p>Convert a <a href="mcf/mcf.html#MultiFlows.MCF"><code>MCF</code></a> instance to GNNGraph object.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; pb = MCF(grid((3,3)), rand(12), rand(12), [Demand(1,9,1.)])
MCF(nv = 9, ne = 24, nk = 1)
	Demand{Int64, Float64}(1, 9, 1.0)

julia&gt; to_gnngraph(pb)
GNNGraph:
  num_nodes: 10
  num_edges: 26
  ndata:
	mask = 10-element Vector{Bool}
  edata:
	e = 3×26 Matrix{Float64}
	demand_amounts_mask = 26-element BitVector
	mask = 26-element Vector{Bool}
	demand_to_source_mask = 26-element Vector{Bool}
	target_to_demand_mask = 26-element Vector{Bool}
  gdata:
	K = 1
	E = 24

</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/augmented_graph.jl#L136-L165">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.demand_amounts-Tuple{GraphNeuralNetworks.GNNGraphs.GNNGraph}" href="#MultiFlows.demand_amounts-Tuple{GraphNeuralNetworks.GNNGraphs.GNNGraph}"><code>MultiFlows.demand_amounts</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">MultiFlows.demand_amounts(g::GNNGraph)</code></pre><p>Get the demand amounts from a GNNGraph.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; demand_amounts(gnn)
3-element Vector{Float64}:
 1.0
 2.0
 3.0
</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/augmented_graph.jl#L288-L303">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.demand_endpoints-Tuple{GraphNeuralNetworks.GNNGraphs.GNNGraph}" href="#MultiFlows.demand_endpoints-Tuple{GraphNeuralNetworks.GNNGraphs.GNNGraph}"><code>MultiFlows.demand_endpoints</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">MultiFlows.demand_endpoints(g::GNNGraph)</code></pre><p>Get the demand endpoints (source and destination vertices) from a GNNGraph.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; pb = MCF(grid((3,3)), rand(12), rand(12), [Demand(1,9,1.), Demand(2,8,2.), Demand(3,7,3.)])
MCF(nv = 9, ne = 24, nk = 3)
	Demand{Int64, Float64}(1, 9, 1.0)
	Demand{Int64, Float64}(2, 8, 2.0)
	Demand{Int64, Float64}(3, 7, 3.0)

julia&gt; gnn = to_gnngraph(pb);

julia&gt; demand_endpoints(gnn)
([1, 2, 3], [9, 8, 7])
</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/augmented_graph.jl#L238-L258">source</a></section></article><h2 id="Datasets"><a class="docs-heading-anchor" href="#Datasets">Datasets</a><a id="Datasets-1"></a><a class="docs-heading-anchor-permalink" href="#Datasets" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.load_dataset-Tuple{String}" href="#MultiFlows.ML.load_dataset-Tuple{String}"><code>MultiFlows.ML.load_dataset</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">load_dataset(dataset_dir::String; 
                  scale_instances::Bool=true, 
                  batchable::Bool=true, 
                  edge_dir::Symbol=:double,
                  feature_type::DataType=Float32,
                  show_progress::Bool=false
)</code></pre><p>Load dataset from directory. If instance directories contain a <code>labels.jld2</code> file it is added to the <code>targets</code> field of the GNNGraph object. If <code>scale_instances=true</code> instances are scaled by calling <a href="mcf/mcf.html#MultiFlows.scale-Union{Tuple{MCF{T, N}}, Tuple{N}, Tuple{T}, Tuple{MCF{T, N}, Any}, Tuple{MCF{T, N}, Any, Any}} where {T, N}"><code>scale</code></a> before being added, if <code>batchable=true</code> a call to <a href="ml_sparsify.html#MultiFlows.ML.make_batchable-Tuple{Vector{GraphNeuralNetworks.GNNGraphs.GNNGraph}}"><code>make_batchable</code></a> is executed on the list of graphs. </p><p><strong>Example</strong></p><p>Create a simple dataset : </p><pre><code class="language-julia-repl hljs">julia&gt; pb = MCF(grid((2,2)), rand(4), rand(4), [Demand(1,4,1.), Demand(1,4,1.), Demand(3,2,1.)]);

julia&gt; # labeling function

julia&gt; function labeling_f(path::String)
           pb = MultiFlows.load(path, edge_dir=:double)
           _,(model,ss) = solve_compact(pb, return_model=true, max_acceptance=true)
           labels = value.(model[:x]) .&gt; 0
           labels_path = joinpath(path, &quot;labels.jld2&quot;)
           jldsave(labels_path; labels)
       end
labeling_f (generic function with 1 method)

julia&gt; # perturbation function

julia&gt; function perturbation_f(pb::MCF)
           generate_example(pb, nK=nk(pb)+rand([-1,0,1]))
       end
perturbation_f (generic function with 1 method)

julia&gt; make_dataset(pb, 5, &quot;small_dataset&quot;, 
                    overwrite=true,
                    perturbation_f=perturbation_f,
                    labeling_f=labeling_f,
                    show_progress=false
                   )
</code></pre><p>Now load the instances. By default <code>load_dataset</code> ensures that the graph features are batchable.</p><pre><code class="language-julia-repl hljs">julia&gt; d = load_dataset(&quot;small_dataset&quot;)
5-element Vector{GNNGraph}:
 GNNGraph(7, 14) with mask: 7-element, (e: 3×14, demand_amounts_mask: 14-element, mask: 14-element, demand_to_source_mask: 14-element, target_to_demand_mask: 14-element), (targets: 8×4×1, K: 0-dimensional, target_mask: 8×4×1, E: 0-dimensional) data
 GNNGraph(6, 12) with mask: 6-element, (e: 3×12, demand_amounts_mask: 12-element, mask: 12-element, demand_to_source_mask: 12-element, target_to_demand_mask: 12-element), (targets: 8×4×1, K: 0-dimensional, target_mask: 8×4×1, E: 0-dimensional) data
 GNNGraph(6, 12) with mask: 6-element, (e: 3×12, demand_amounts_mask: 12-element, mask: 12-element, demand_to_source_mask: 12-element, target_to_demand_mask: 12-element), (targets: 8×4×1, K: 0-dimensional, target_mask: 8×4×1, E: 0-dimensional) data
 GNNGraph(6, 12) with mask: 6-element, (e: 3×12, demand_amounts_mask: 12-element, mask: 12-element, demand_to_source_mask: 12-element, target_to_demand_mask: 12-element), (targets: 8×4×1, K: 0-dimensional, target_mask: 8×4×1, E: 0-dimensional) data
 GNNGraph(8, 16) with mask: 8-element, (e: 3×16, demand_amounts_mask: 16-element, mask: 16-element, demand_to_source_mask: 16-element, target_to_demand_mask: 16-element), (targets: 8×4×1, K: 0-dimensional, target_mask: 8×4×1, E: 0-dimensional) data

julia&gt; batch(d)
GNNGraph:
  num_nodes: 33
  num_edges: 66
  num_graphs: 5
  ndata:
	mask = 33-element Vector{Bool}
  edata:
	e = 3×66 Matrix{Float32}
	demand_amounts_mask = 66-element BitVector
	mask = 66-element Vector{Bool}
	demand_to_source_mask = 66-element Vector{Bool}
	target_to_demand_mask = 66-element Vector{Bool}
  gdata:
	targets = 8×4×5 Array{Bool, 3}
	K = 5-element Vector{Int64}
	target_mask = 8×4×5 Array{Bool, 3}
	E = 5-element Vector{Int64}
</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/dataset.jl#L116-L189">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.load_instance-Tuple{Any}" href="#MultiFlows.ML.load_instance-Tuple{Any}"><code>MultiFlows.ML.load_instance</code></a> — <span class="docstring-category">Method</span></header><section><div><p>Load single instance</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/dataset.jl#L270-L272">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.make_batchable-Tuple{Vector{GraphNeuralNetworks.GNNGraphs.GNNGraph}}" href="#MultiFlows.ML.make_batchable-Tuple{Vector{GraphNeuralNetworks.GNNGraphs.GNNGraph}}"><code>MultiFlows.ML.make_batchable</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">make_batchable(gl::Vector{GNNGraph})</code></pre><p>Make GNNGraphs batchable, pads the <code>targets</code> fields with zeros thus ensuring that those fields may be concatenanted along their last dimension. Adds the <code>target_mask</code> field so that <code>g.targets[g.target_mask]</code> returns the original target values.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; pb1 = MCF(grid((2,2)), rand(4), rand(4), [Demand(1,4,1.), Demand(1,4,1.), Demand(3,2,1.)]);

julia&gt; _,(mod1,_) = solve_compact(pb1, max_acceptance=true, return_model=true);

julia&gt; y1 = value.(mod1[:x]) .&gt; 0 ;

julia&gt; gnn1 = to_gnngraph(pb1, y1)
GNNGraph:
  num_nodes: 7
  num_edges: 14
  ndata:
	mask = 7-element Vector{Bool}
  edata:
	e = 3×14 Matrix{Float64}
	demand_amounts_mask = 14-element BitVector
	mask = 14-element Vector{Bool}
	demand_to_source_mask = 14-element Vector{Bool}
	target_to_demand_mask = 14-element Vector{Bool}
  gdata:
	targets = 8×3×1 BitArray{3}
	K = 3
	E = 8

julia&gt; pb2 = MCF(grid((2,3)), rand(7), rand(7), [Demand(1,4,1.), Demand(1,4,1.), Demand(3,2,1.)]);

julia&gt; _,(mod2,_) = solve_compact(pb2, max_acceptance=true, return_model=true);

julia&gt; y2 = value.(mod2[:x]) .&gt; 0 ;

julia&gt; gnn2 = to_gnngraph(pb2, y2)
GNNGraph:
  num_nodes: 9
  num_edges: 20
  ndata:
	mask = 9-element Vector{Bool}
  edata:
	e = 3×20 Matrix{Float64}
	demand_amounts_mask = 20-element BitVector
	mask = 20-element Vector{Bool}
	demand_to_source_mask = 20-element Vector{Bool}
	target_to_demand_mask = 20-element Vector{Bool}
  gdata:
	targets = 14×3×1 BitArray{3}
	K = 3
	E = 14
</code></pre><p>If we try to create a batch of <code>gnn1</code> and <code>gnn2</code> a <code>DimensionMismatch</code> error is raised : </p><pre><code class="language-julia-repl hljs">julia&gt; batch([gnn1, gnn2])
ERROR: DimensionMismatch(&quot;mismatch in dimension 1 (expected 8 got 14)&quot;)
[...]</code></pre><pre><code class="language-julia-repl hljs">julia&gt; gl = make_batchable(GNNGraph[gnn1,gnn2])
2-element Vector{GNNGraph}:
 GNNGraph(7, 14) with mask: 7-element, (e: 3×14, demand_amounts_mask: 14-element, mask: 14-element, demand_to_source_mask: 14-element, target_to_demand_mask: 14-element), (targets: 14×3×1, K: 0-dimensional, target_mask: 14×3×1, E: 0-dimensional) data
 GNNGraph(9, 20) with mask: 9-element, (e: 3×20, demand_amounts_mask: 20-element, mask: 20-element, demand_to_source_mask: 20-element, target_to_demand_mask: 20-element), (targets: 14×3×1, K: 0-dimensional, target_mask: 14×3×1, E: 0-dimensional) data

julia&gt; batch_g = batch(gl)
GNNGraph:
  num_nodes: 16
  num_edges: 34
  num_graphs: 2
  ndata:
	mask = 16-element Vector{Bool}
  edata:
	e = 3×34 Matrix{Float64}
	demand_amounts_mask = 34-element BitVector
	mask = 34-element Vector{Bool}
	demand_to_source_mask = 34-element Vector{Bool}
	target_to_demand_mask = 34-element Vector{Bool}
  gdata:
	targets = 14×3×2 Array{Bool, 3}
	K = 2-element Vector{Int64}
	target_mask = 14×3×2 Array{Bool, 3}
	E = 2-element Vector{Int64}</code></pre><p>Retrieving the labels </p><pre><code class="language-julia-repl hljs">julia&gt; gl[1].targets[gl[1].target_mask] == vec(y1)
true

julia&gt; gl[2].targets[gl[2].target_mask] == vec(y2)
true

julia&gt; batch_g.targets[batch_g.target_mask] == vcat(vec(y1), vec(y2))
true</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/dataset.jl#L1-L100">source</a></section></article><h2 id="Layers-and-utilities"><a class="docs-heading-anchor" href="#Layers-and-utilities">Layers and utilities</a><a id="Layers-and-utilities-1"></a><a class="docs-heading-anchor-permalink" href="#Layers-and-utilities" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.compute_edge_demand_scores-Tuple{Any, AbstractMatrix, AbstractMatrix, GraphNeuralNetworks.GNNGraphs.GNNGraph}" href="#MultiFlows.ML.compute_edge_demand_scores-Tuple{Any, AbstractMatrix, AbstractMatrix, GraphNeuralNetworks.GNNGraphs.GNNGraph}"><code>MultiFlows.ML.compute_edge_demand_scores</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">compute_edge_demand_scores(model, 
                           edge_codes::AbstractMatrix, 
                           demand_codes::AbstractMatrix, 
                           g::GNNGraph;
)</code></pre><p>Compute the edge-demand scores with classifier model <code>model</code>, edge codes <code>edge_codes</code>, demand codes <code>demand_codes</code> and on graph <code>g</code>. Returns a <code>(1, ne(pb) * nk(pb))</code> size matrix that should be reshaped <code>reshape(scores, ne(pb), nk(pb))</code> so that value <code>s[a,k]</code> corresponds to the score of the edge-demand pair <span>$(a,k)$</span>.</p><p><strong>Example</strong></p><p>Create a simple instance and model with edge and demand encoding space of 2</p><pre><code class="language-julia-repl hljs">julia&gt; pb = MCF(grid((2,2)), rand(4), rand(4), [Demand(1,4,1.), Demand(1,4,1.), Demand(3,2,1.)]);

julia&gt; model = M8ClassifierModel(2, 3, 1, nv(pb));

julia&gt; model.scoring.weight[1,:,:] .= diagm(ones(2)); # for simplicity

julia&gt; gnn = to_gnngraph(pb, feature_type=Float32);</code></pre><p>Create some edge and demand codes and compute scores </p><pre><code class="language-julia-repl hljs">julia&gt; edge_codes = reshape(1:2*(ne(pb)+2*nk(pb)), 2, ne(pb)+2*nk(pb))
2×14 reshape(::UnitRange{Int64}, 2, 14) with eltype Int64:
 1  3  5  7   9  11  13  15  17  19  21  23  25  27
 2  4  6  8  10  12  14  16  18  20  22  24  26  28

julia&gt; demand_codes = reshape(1:2*nk(pb), 2, nk(pb))
2×3 reshape(::UnitRange{Int64}, 2, 3) with eltype Int64:
 1  3  5
 2  4  6

julia&gt; s = compute_edge_demand_scores(model, edge_codes, demand_codes, gnn);

julia&gt; s = reshape(s, ne(pb), nk(pb))
8×3 Matrix{Float32}:
  5.0   11.0   17.0
 11.0   25.0   39.0
 17.0   39.0   61.0
 23.0   53.0   83.0
 29.0   67.0  105.0
 35.0   81.0  127.0
 41.0   95.0  149.0
 47.0  109.0  171.0

julia&gt; s[3, 2] == dot(edge_codes[:,3], demand_codes[:,2])
true</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/classifier_utils.jl#L1-L51">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.concat_nodes-Tuple{AbstractMatrix, AbstractMatrix, Nothing}" href="#MultiFlows.ML.concat_nodes-Tuple{AbstractMatrix, AbstractMatrix, Nothing}"><code>MultiFlows.ML.concat_nodes</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">concat_nodes(xi::AbstractMatrix, xj::AbstractMatrix, e::Nothing)</code></pre><p>Utility function for concatenating node features.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/classifier_utils.jl#L154-L158">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.make_demand_codes-Tuple{AbstractMatrix, AbstractMatrix, GraphNeuralNetworks.GNNGraphs.GNNGraph}" href="#MultiFlows.ML.make_demand_codes-Tuple{AbstractMatrix, AbstractMatrix, GraphNeuralNetworks.GNNGraphs.GNNGraph}"><code>MultiFlows.ML.make_demand_codes</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">make_demand_codes(node_codes::AbstractMatrix, demand_node_codes::AbstractMatrix, g::GNNGraph)</code></pre><p>Takes node codes and demand node codes and concatenates codes for <span>$s_k$</span>, <span>$t_k$</span> and the demand node code for <span>$k$</span>.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; demand_node_codes = reshape(1:3*nk(pb), 3, nk(pb))
3×3 reshape(::UnitRange{Int64}, 3, 3) with eltype Int64:
 1  4  7
 2  5  8
 3  6  9

julia&gt; make_demand_codes(node_codes, demand_node_codes, gnn)
7×3 Matrix{Int64}:
 1  1  5
 2  2  6
 7  7  3
 8  8  4
 1  4  7
 2  5  8
 3  6  9
</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/classifier_utils.jl#L123-L148">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.make_demand_codes-Tuple{AbstractMatrix, GraphNeuralNetworks.GNNGraphs.GNNGraph}" href="#MultiFlows.ML.make_demand_codes-Tuple{AbstractMatrix, GraphNeuralNetworks.GNNGraphs.GNNGraph}"><code>MultiFlows.ML.make_demand_codes</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">make_demand_codes(node_codes::AbstractMatrix, g::GNNGraph)</code></pre><p>Takes the node codes and computes the demand codes by concatening the codes of <span>$s_k$</span> and <span>$t_k$</span>.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; pb.demands
3-element Vector{Demand{Int64, Float64}}:
 Demand{Int64, Float64}(1, 4, 1.0)
 Demand{Int64, Float64}(1, 4, 1.0)
 Demand{Int64, Float64}(3, 2, 1.0)

julia&gt; node_codes = reshape(1:2*nv(pb), 2, nv(pb))
2×4 reshape(::UnitRange{Int64}, 2, 4) with eltype Int64:
 1  3  5  7
 2  4  6  8

julia&gt; make_demand_codes(node_codes, gnn)
4×3 Matrix{Int64}:
 1  1  5
 2  2  6
 7  7  3
 8  8  4
</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/classifier_utils.jl#L91-L117">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.M3EdgeReverseLayer" href="#MultiFlows.ML.M3EdgeReverseLayer"><code>MultiFlows.ML.M3EdgeReverseLayer</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">M3EdgeReverseLayer &lt;: GraphNeuralNetworks.GNNLayer</code></pre><p>Utility layer, reverses the directions of the graph edges and returns new GNNGraph.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/layer_utils.jl#L1-L5">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.M3EdgeReverseLayer-Tuple{GraphNeuralNetworks.GNNGraphs.GNNGraph}" href="#MultiFlows.ML.M3EdgeReverseLayer-Tuple{GraphNeuralNetworks.GNNGraphs.GNNGraph}"><code>MultiFlows.ML.M3EdgeReverseLayer</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">(l::M3EdgeReverseLayer)(g::GNNGraph)</code></pre><p>Definition of the forward call for the <a href="ml_sparsify.html#MultiFlows.ML.M3EdgeReverseLayer"><code>M3EdgeReverseLayer</code></a>. Features are not changed.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; g = GNNGraph([1,2,3],[2,3,1],ndata=(;x=rand(2,3)),edata=(;e=rand(4,3)))
GNNGraph:
  num_nodes: 3
  num_edges: 3
  ndata:
	x = 2×3 Matrix{Float64}
  edata:
	e = 4×3 Matrix{Float64}

julia&gt; edge_index(g)
([1, 2, 3], [2, 3, 1])

julia&gt; gr = M3EdgeReverseLayer()(g);

julia&gt; edge_index(gr)
([2, 3, 1], [1, 2, 3])
</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/layer_utils.jl#L9-L34">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.MLP-Tuple{Any, Any, Any}" href="#MultiFlows.ML.MLP-Tuple{Any, Any, Any}"><code>MultiFlows.ML.MLP</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">MLP(in_dim, out_dim, hidden_dim; drop_p=0.1)</code></pre><p>Build a Multi-layer perceptron with input dimension <code>in_dim</code>, output dimension <code>out_dim</code> and hidden dimension <code>hidden_dim</code>. <code>drop_p</code> is the dropout probability.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; m = MLP(2, 3, 4)
Chain([
  Dense(2 =&gt; 4, relu),                  # 12 parameters
  Dropout(0.1),
  Dense(4 =&gt; 4, relu),                  # 20 parameters
  Dropout(0.1),
  Dense(4 =&gt; 3),                        # 15 parameters
  Dropout(0.1),
])                  # Total: 6 arrays, 47 parameters, 620 bytes.
</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/layer_utils.jl#L42-L60">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.MyMEGNetConv3-Tuple{Int64}" href="#MultiFlows.ML.MyMEGNetConv3-Tuple{Int64}"><code>MultiFlows.ML.MyMEGNetConv3</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">MyMEGNetConv3(n::Int64; drop_p::Float64=0.1)</code></pre><p>MEGNetConv version 3. Implementation of a message passing layer based on <em>GraphNeuralNetworks.jl</em> <code>MEGNetConv</code> layer with a multi-layer perceptron for edge and vertex encoding.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; MyMEGNetConv3(2)
GraphNeuralNetworks.MEGNetConv{Flux.Chain{Vector{Any}}, Flux.Chain{Vector{Any}}, typeof(Statistics.mean)}(Chain([Dense(6 =&gt; 4, relu), Dropout(0.1), BatchNorm(4), Dense(4 =&gt; 4, relu), Dropout(0.1), BatchNorm(4), Dense(4 =&gt; 2)]), Chain([Dense(4 =&gt; 4, relu), Dropout(0.1), BatchNorm(4), Dense(4 =&gt; 4, relu), Dropout(0.1), BatchNorm(4), Dense(4 =&gt; 2)]), Statistics.mean)
</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/layer_utils.jl#L72-L83">source</a></section></article><h2 id="Classifier-model"><a class="docs-heading-anchor" href="#Classifier-model">Classifier model</a><a id="Classifier-model-1"></a><a class="docs-heading-anchor-permalink" href="#Classifier-model" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.M8ClassifierModel" href="#MultiFlows.ML.M8ClassifierModel"><code>MultiFlows.ML.M8ClassifierModel</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">M8ClassifierModel</code></pre><p>Classifier model.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/model8_definition.jl#L89-L93">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.M8ClassifierModel-NTuple{4, Int64}" href="#MultiFlows.ML.M8ClassifierModel-NTuple{4, Int64}"><code>MultiFlows.ML.M8ClassifierModel</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">M8ClassifierModel(node_feature_dim::Int64, 
                  edge_feature_dim::Int64, 
                  n_layers::Int64, 
                  nnodes::Int64; 
                  drop_p::Float64=0.1,
                  device::Function=CUDA.functional() ? Flux.gpu : Flux.cpu,
)</code></pre><p><code>M8ClassifierModel</code> constructor with node embedding dimension <code>node_feature_dim</code>, input edge features <code>edge_feature_dim</code> (value is 3 for basic MCF instances), number of message passing layers <code>n_layers</code> and number of nodes in the graph <code>nnodes</code>. <code>drop_p</code> is the dropout probability used in the message passing layers. </p><p>Current implementation of the edge-demand scores requires passing the device (GPU, CPU) to the constructor. If a GPU is available it is used.</p><p>This model design works on datasets constructed from a single graph. It relies on a node embedding dictionary and thus we need to know in advance the number of nodes in the graph. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/model8_definition.jl#L107-L121">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.M8ClassifierModel-Tuple{GraphNeuralNetworks.GNNGraphs.GNNGraph}" href="#MultiFlows.ML.M8ClassifierModel-Tuple{GraphNeuralNetworks.GNNGraphs.GNNGraph}"><code>MultiFlows.ML.M8ClassifierModel</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">(model::M8ClassifierModel)(g::GNNGraph)</code></pre><p><a href="ml_sparsify.html#MultiFlows.ML.M8ClassifierModel"><code>M8ClassifierModel</code></a> forward call. Returns the flattened edge-demand score matrix.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; y = model(g);

julia&gt; size(y)
(1, 24)

julia&gt; size(y,2) == ne(pb) * nk(pb)
true
</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/model8_definition.jl#L242-L259">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.M8ClassifierModel-Tuple{MCF}" href="#MultiFlows.ML.M8ClassifierModel-Tuple{MCF}"><code>MultiFlows.ML.M8ClassifierModel</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">(model::M8ClassifierModel)(pb::MCF)</code></pre><p><a href="ml_sparsify.html#MultiFlows.ML.M8ClassifierModel"><code>M8ClassifierModel</code></a> forward call for MCF problem <code>pb</code>. Returns a <code>(ne(pb), nk(pb))</code> matrix.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; y = model(pb);

julia&gt; size(y)
(8, 3)

julia&gt; size(y,1) == ne(pb)
true

julia&gt; size(y,2) == nk(pb)
true
</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/model8_definition.jl#L285-L305">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.M8MPLayer" href="#MultiFlows.ML.M8MPLayer"><code>MultiFlows.ML.M8MPLayer</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">M8MPLayer</code></pre><p>Message passing layer. Based on <em>GraphNeuralNetworks.jl</em> <code>MEGNetConv</code> layer with vertex and edge feature normalization and dropout layers. Messages are passed forward through the edges, backward and the results averaged.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/model8_definition.jl#L6-L10">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.M8MPLayer-Tuple{Any, Any, Any}" href="#MultiFlows.ML.M8MPLayer-Tuple{Any, Any, Any}"><code>MultiFlows.ML.M8MPLayer</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">(l::M8MPLayer)(g, x, e)</code></pre><p><code>M8MPLayer</code> forward call.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; g = GNNGraph([1,2,3], [2,3,1]);

julia&gt; x, e = rand(Float32, 4, 3), rand(Float32, 5, 3);

julia&gt; m = M8MPLayer(2);

julia&gt; x, e = m(g, x, e)
(Float32[0.048501432 0.011552513 0.4102404; 0.52121377 0.8908787 0.52566236; … ; -0.019039169 -0.003820137 -0.024450637; 0.008280508 0.0007322127 0.014470182], Float32[0.82208836 0.58055997 0.8296713; 0.044817984 0.4181347 0.83622855; … ; 0.26154602 0.20365497 -0.019983638; -0.28453535 -0.042258546 -0.058157448])

julia&gt; size(x), size(e)
((6, 3), (7, 3))
</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/model8_definition.jl#L48-L68">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.M8MPLayer-Tuple{Int64}" href="#MultiFlows.ML.M8MPLayer-Tuple{Int64}"><code>MultiFlows.ML.M8MPLayer</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">M8MPLayer(n::Int64; drop_p::Float64=.1)</code></pre><p><code>M8MPLayer</code> constructor. This layer has the same input and output dimension <code>n</code>.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; m = M8MPLayer(2)
M8MPLayer(GraphNeuralNetworks.MEGNetConv{Flux.Chain{Vector{Any}}, Flux.Chain{Vector{Any}}, typeof(Statistics.mean)}(Chain([Dense(6 =&gt; 4, relu), Dropout(0.1), BatchNorm(4), Dense(4 =&gt; 4, relu), Dropout(0.1), BatchNorm(4), Dense(4 =&gt; 2)]), Chain([Dense(4 =&gt; 4, relu), Dropout(0.1), BatchNorm(4), Dense(4 =&gt; 4, relu), Dropout(0.1), BatchNorm(4), Dense(4 =&gt; 2)]), Statistics.mean), Dropout(0.1), Dropout(0.1), BatchNorm(2), BatchNorm(2), M3EdgeReverseLayer(), GraphNeuralNetworks.MEGNetConv{Flux.Chain{Vector{Any}}, Flux.Chain{Vector{Any}}, typeof(Statistics.mean)}(Chain([Dense(6 =&gt; 4, relu), Dropout(0.1), BatchNorm(4), Dense(4 =&gt; 4, relu), Dropout(0.1), BatchNorm(4), Dense(4 =&gt; 2)]), Chain([Dense(4 =&gt; 4, relu), Dropout(0.1), BatchNorm(4), Dense(4 =&gt; 4, relu), Dropout(0.1), BatchNorm(4), Dense(4 =&gt; 2)]), Statistics.mean), 2)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/model8_definition.jl#L24-L34">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.compute_graph_embeddings-Tuple{MultiFlows.ML.M8ClassifierModel, GraphNeuralNetworks.GNNGraphs.GNNGraph}" href="#MultiFlows.ML.compute_graph_embeddings-Tuple{MultiFlows.ML.M8ClassifierModel, GraphNeuralNetworks.GNNGraphs.GNNGraph}"><code>MultiFlows.ML.compute_graph_embeddings</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">compute_graph_embeddings(model::M8ClassifierModel, g::GNNGraph)</code></pre><p>Compute the graph embeddings, returns a matrix for the vertex embeddings and another for the edge embeddings.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; pb = MCF(grid((2,2)), rand(4), rand(4), [Demand(1,4,1.), Demand(1,4,1.), Demand(3,2,1.)])
MCF(nv = 4, ne = 8, nk = 3)
	Demand{Int64, Float64}(1, 4, 1.0)
	Demand{Int64, Float64}(1, 4, 1.0)
	Demand{Int64, Float64}(3, 2, 1.0)

julia&gt; g = to_gnngraph(pb, feature_type=Float32);

julia&gt; model = M8ClassifierModel(4, 3, 2, nv(pb));

julia&gt; node_codes, edge_codes = compute_graph_embeddings(model, g)
(Float32[-1.3416092 -0.07616795 … -0.10367019 -0.204979; 0.41216165 -0.65490055 … -0.018500613 -0.036579825; … ; -0.09281337 -0.040796205 … -0.016434366 -0.009337337; -0.018684518 -0.018848153 … 0.0015017446 0.009444744], Float32[-0.00523452 -0.028606605 … -0.1676333 -0.1676333; 0.0027749126 0.0024765532 … 0.10864657 0.10864657; … ; 0.022817744 0.02496451 … 0.020531857 0.0015449864; 0.067348234 0.079991825 … 0.02253621 0.007676319])

julia&gt; size(node_codes), size(edge_codes)
((12, 7), (12, 14))

julia&gt; size(node_codes,2) == nv(pb)+nk(pb)
true

julia&gt; size(edge_codes,2) == ne(pb)+2*nk(pb)
true
</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/model8_definition.jl#L142-L172">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MultiFlows.ML.make_demand_codes-Tuple{MultiFlows.ML.M8ClassifierModel, GraphNeuralNetworks.GNNGraphs.GNNGraph}" href="#MultiFlows.ML.make_demand_codes-Tuple{MultiFlows.ML.M8ClassifierModel, GraphNeuralNetworks.GNNGraphs.GNNGraph}"><code>MultiFlows.ML.make_demand_codes</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">make_demand_codes(model::M8ClassifierModel, g::GNNGraph)</code></pre><p>Make the demand codes.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; demand_codes = make_demand_codes(model, g);

julia&gt; size(demand_codes)
(36, 3)

julia&gt; size(demand_codes,2) == nk(pb)
true
</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Dolgalad/MultiFlows.jl/blob/51b881dd0b4ebd4177fb8274e130542d712149b6/src/ML/model8_definition.jl#L217-L234">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="sparsify.html">« MCF Sparsification</a><a class="docs-footer-nextpage" href="development.html">Installation and Development »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Wednesday 28 February 2024 20:05">Wednesday 28 February 2024</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
